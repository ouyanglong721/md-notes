# 索引

> 索引的出现就是为了提高数据查询的效率，如书的目录

## 常见索引结构

索引通常有几种常用的数据结构

- key-val结构（hash）

  优点：查询速度快

  缺点：范围查询效率低

  **适合等值查询**。

- 有序数组

  如下，将数据根据id递增的顺序，直接存放在数组里面，通过二分就可以进行快速的查询，但是插入时效率较低，**需要将所有的数据往后移动**，因此适合**静态存储。**

  ![img](https://oylong-blog-pic.oss-cn-shenzhen.aliyuncs.com/blog/img/bfc907a92f99cadf5493cf0afac9ca49.png)

- 树

 1. 二叉搜索树

     父节点左边的值小于父节点的值，父节点右边的值大于父节点。为了维护查询效率`（O(logn））`，需要维护树的平衡`（O(logn））。`

  2. N叉树

     N取决于数据块的大小，能够在较少的磁盘访问的次数下找到数据。



## InnoDB索引模型

InnoDB使用**B+树**索引模型，**每一个索引在InnoDB里都对应一个B+树**。

如下图：

![img](https://oylong-blog-pic.oss-cn-shenzhen.aliyuncs.com/blog/img/dcda101051f28502bd5c4402b292e38d.png)

根据**叶子节点内容**的不同，我们可以将索引分为*主键索引*（聚簇索引）和*非主键索引*（二级索引）。

基于非主键索引的查询通常需要回表。

> 基于非主键索引在没有联合索引的情况下会先通过非主键索引的B+树找到对应主键，再去主键的B+树中通过主键去查记录，这个过程就称为回表。



## 索引维护

由于B+树的需要维护索引的有序性，因此在插入和删除记录时，可能会导致**页分裂和页合并**发生，这会影响数据库性能。因此大多数情况下，建议使用自增主键。